# 滴滴开源小程序框架Mpx发布2.0，完善支持小程序跨平台开发

Mpx是一款致力于提高小程序开发体验和效率的增强型小程序框架，目前在滴滴公司内部支撑了包括滴滴出行小程序，滴滴出行广场小程序，青桔单车，黑马电单车，小桔养车，小桔加油在内的小程序生态；自去年11月开源以来，Mpx也吸纳了众多外部开发者的加入，对外支撑了开走吧，好免街，花忆等小程序的开发与迭代。

长期以来，Mpx优秀的开发体验和强大的稳定性得到了内外开发者的一致认可和好评，这非常符合Mpx的设计初衷。但是在各大厂商陆续推出自己的小程序平台，且各家的技术标准都不统一的今天，单纯地提高某一个平台的开发体验已经不能满足广大小程序开发者们的诉求，`一套代码在多小程序平台运行`已经成为一个现实上的刚需。为了解决这个小程序开发的痛点，我们适配了目前业内已经发布的所有小程序平台(微信、支付宝、百度、头条、qq)，并且提供了将其中一个平台的源代码转换编译到其他平台运行的能力。

此外，Mpx比业内其他框架都更重视小程序的开发体验和程序性能，我们在这方面做了非常多的工作并且得到了非常显著的成效，下面也会一一展开进行介绍。

## 跨平台开发

作为2.0版本的核心能力，Mpx的跨平台开发能力允许用户直接将当前某一个小程序平台的项目编译输出到其他已支持的小程序平台中运行。微信小程序作为小程序概念的提出者，有着最广泛的生态覆盖，因此我们优先支持了将微信小程序编译为其他平台小程序的能力。基于这个能力，用户不仅能跨平台编译微信Mpx项目，甚至能够将微信的原生自定义组件也编译到其他小程序平台进行运行，这意味着我们的跨平台项目能够直接使用一些社区内已有的UI组件库生态，极大地提高了跨平台开发的适用范围。

### 设计理念

Mpx框架的核心设计理念在于增强，增强是指在小程序已有的原生能力基础上做加法，以拓展小程序的开发能力，提高小程序的开发体验和效率。这个设计理念使Mpx给开发者带来了更强的开发稳定性和可预期性，更低的学习上手和调试成本，得到了用户开发者的一致好评。基于这个理念，Mpx在不同的小程序平台中进行了差异性的增强适配，也基于各个平台的模板指令风格提供了不同的增强模板指令集，让用户在各小程序平台中都可以以增强的方式去最大限度地使用平台自有的原生能力。

与此同时，我们在对Mpx提供跨平台能力的支持时也遵循了增强的核心设计理念。简单来讲，Mpx的跨平台能力是在多平台能力的基础上，在编译和运行时增加了一层转换层，将源平台的代码转换为目标平台的代码之后，再按照既有的目标平台的处理逻辑进行增强，同时我们也提供了一套完善的条件编辑机制，让用户自行实现少数框架无法转换的部分。

![Mpx跨平台开发流程示意图](https://dpubstatic.udache.com/static/dpubimg/d462e4c8-7c78-4225-80a4-deef91a47061.png)

*Mpx跨平台开发流程示意图*

Mpx跨平台能力设计思路明显有别于业内已有的其他小程序跨平台框架，主要差异在于：
* Mpx以小程序本身的DSL作为基准，而没有使用web框架(React,Vue)的DSL；
* Mpx主要通过编译和运行时转换的方式处理平台差异，没有提供额外的差异抹平层(基础组件库等)。

之所以采用这种设计，主要基于以下原因：
* Mpx主要以跨小程序平台为目标，目前各大小程序平台的技术规范具有一定相似性，绝大部分平台差异能够通过编译和运行时手段抹平，同时省去的差异抹平层也能进一步减少框架体积；
* 使用小程序本身的DSL作为基准允许用户直接在已有项目中使用跨平台能力，对于原生小程序项目或组件也能够使用该能力进行跨平台输出；
* 通过条件编译确保了











### 差异抹平

### 条件编译

## setData优化

## 分包支持

## 原生兼容

## 未来规划





